<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title></title>
	<link rel="stylesheet" href="../src/css/sb.css" />
	<script id="toonFragmentShader" type="x-shader/x-fragment">

uniform vec3 diffuse;
uniform vec3 ambient;
uniform vec3 specular;
uniform float shininess;
varying vec2 vUv;
uniform sampler2D uDiffuseTexture;
uniform sampler2D uToonTexture;
uniform vec3 ambientLightColor;
#if MAX_DIR_LIGHTS > 0
uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];
uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];
#endif
varying vec3 vViewPosition;
varying vec3 vNormal;

void main() {

	vec3 normal = normalize( vNormal );
	vec3 viewPosition = normalize( vViewPosition );

	vec3 lightDir = vec3(0.0, 1.0, 0.0);
	vec3 lightColor = vec3(0.8, 0.8, 0.8);
	
	vec4 lDirection = viewMatrix * vec4( lightDir, 0.0 );
	vec3 dirVector = normalize( lDirection.xyz );
	vec3 dirHalfVector = normalize( lDirection.xyz + viewPosition );
	float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );
	float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );
	float dirSpecularWeight = pow( dirDotNormalHalf, shininess );
	
	vec4 toonDiffuseWeight = texture2D(uToonTexture, vec2(dirDiffuseWeight, 0));
	vec4 toonSpecularWeight = texture2D(uToonTexture, vec2(dirSpecularWeight, 0));
	dirDiffuseWeight = toonDiffuseWeight.x;
	dirSpecularWeight = toonSpecularWeight.x;
	//dirDiffuseWeight = (texture2D(uToonTexture, dirDiffuseWeight)).x;
	//dirDiffuseSpecularWeight = (texture2D(uToonTexture, dirSpecularWeight)).x;
	vec3 dirSpecular = specular * lightColor * dirSpecularWeight * dirDiffuseWeight;
	vec3 dirDiffuse = diffuse * lightColor * dirDiffuseWeight;

	gl_FragColor = vec4(( dirDiffuse + ambientLightColor * ambient ) + dirSpecular, 1.0);
}
		
	</script>
	<script id="toonVertexShader" type="x-shader/x-vertex">
varying vec3 vViewPosition;
varying vec3 vNormal;
varying vec2 vUv;
uniform vec4 offsetRepeat;

void main() {
	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	vUv = uv;

	vViewPosition = -mvPosition.xyz;
	vNormal = normalMatrix * normal;

	gl_Position = projectionMatrix * mvPosition;
}

	</script>
    <script src="../libs/JQuery/jquery-1.6.4.js"></script>
    <script src="../libs/jquery-mousewheel-3.0.4/jquery.mousewheel.js"></script>
    <script src="../libs/three/Three.js"></script>
	<script src="../libs/three/Stats.js"></script>
    <script src="../libs/Box2D/box2d.min.js"></script>
	<script src="../libs/requestAnimationFrame/RequestAnimationFrame.js"></script>
    <script src="../build-debug/sb.js"></script>
    <script src="gabscape-network.js"></script>
    <script src="gabber.js"></script>
    <script src="gabatar.js"></script>
	<script src="GabClient.js"></script>
	<script src="faye-browser.js"></script>
    <script src="gabscape-GabClient.js"></script>
    <script src="gabsound.js"></script>
    <script>
      goog.require('SB.Game');
    </script>
</head>
<body>
<div id="container" style="background-image:url('./images/skybox01.jpg'); overflow:hidden; width:98%; height:98%; position:absolute;"></div>
    <script>
        var game = new Gabscape();
		var container = document.getElementById("container");
        game.initialize( { container : container } );
        SB.Graphics.instance.renderer.domElement.focus();
        game.run();
    </script>
</body>
</html>
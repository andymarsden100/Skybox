<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title></title>
	<script id="toonFragmentShader" type="x-shader/x-fragment">
uniform mat4 viewMatrix;
uniform vec3 cameraPosition;
uniform vec3 diffuse;
uniform float opacity;
uniform vec3 ambient;
uniform vec3 specular;
uniform float shininess;
varying vec2 vUv;
uniform sampler2D map;
uniform vec3 ambientLightColor;
#if MAX_DIR_LIGHTS > 0
uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];
uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];
#endif
varying vec3 vViewPosition;
varying vec3 vNormal;

void main() {
	vec3 normal = normalize( vNormal );
	vec3 viewPosition = normalize( vViewPosition );

	vec3 dirDiffuse  = vec3( 0.0 );
	vec3 dirSpecular = vec3( 0.0 );
	for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {
	vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );
	vec3 dirVector = normalize( lDirection.xyz );
	vec3 dirHalfVector = normalize( lDirection.xyz + viewPosition );
	float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );
	float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );
	float dirSpecularWeight = pow( dirDotNormalHalf, shininess );
	dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;
	dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;

	vec3 totalDiffuse = vec3( 0.0 );
	vec3 totalSpecular = vec3( 0.0 );

	totalDiffuse += dirDiffuse;
	totalSpecular += dirSpecular;

	gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;
}
		
	</script>
	<script id="toonVertexShader" type="x-shader/x-vertex">
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat3 normalMatrix;
attribute vec3 position;
attribute vec3 normal;
attribute vec2 uv;

varying vec3 vViewPosition;
varying vec3 vNormal;
varying vec2 vUv;
uniform vec4 offsetRepeat;

void main() {
	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	vUv = uv;

	vViewPosition = -mvPosition.xyz;
	vNormal = normalMatrix * normal;

	gl_Position = projectionMatrix * mvPosition;
}

	</script>
    <script src="../libs/JQuery/jquery-1.6.4.js"></script>
    <script src="../libs/jquery-mousewheel-3.0.4/jquery.mousewheel.js"></script>
    <script src="../libs/three/Three.js"></script>
	<script src="../libs/three/Stats.js"></script>
    <script src="../libs/Box2D/box2d.min.js"></script>
	<script src="../libs/requestAnimationFrame/RequestAnimationFrame.js"></script>
    <script src="../build-debug/sb.js"></script>
    <script src="toon.js"></script>

    <script>
      goog.require('SB.Game');
    </script>
</head>
<body>
<div id="container" style="width:98%; height:98%; position:absolute;"></div>
    <script>
        var game = new SB.Examples.ToonDemo();
		var container = document.getElementById("container");
        game.initialize( { container : container } );
        game.run();
    </script>
</body>
</html>